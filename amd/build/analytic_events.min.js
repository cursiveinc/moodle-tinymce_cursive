define("tiny_cursive/analytic_events",["exports","./analytic_modal","core/ajax","jquery","core/modal_factory","core/str"],(function(_exports,_analytic_modal,_ajax,_jquery,_modal_factory,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module analytic_events
   *
   * @module     tiny_cursive/analytic_events
   * @copyright  2024 YOUR NAME <your@email.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_analytic_modal=_interopRequireDefault(_analytic_modal),_jquery=_interopRequireDefault(_jquery),_modal_factory=_interopRequireDefault(_modal_factory),_str=_interopRequireDefault(_str);return _exports.default=class{createModal(userid,context){let questionid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",authIcon=arguments.length>3?arguments[3]:void 0;(0,_jquery.default)("#analytics"+userid+questionid).on("click",(function(e){e.preventDefault(),_modal_factory.default.create({type:_analytic_modal.default.TYPE,templateContext:context}).then((modal=>{modal.show();const targetElement=(0,_jquery.default)("#content"+userid+" .table tbody tr:first-child td:nth-child(2)");targetElement.length>0?targetElement.html(authIcon):console.error("Target element not found")})).catch((error=>{console.error("Failed to create modal:",error)}))}))}analytics(userid,templates,context){let questionid=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",replayInstances=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,authIcon=arguments.length>5?arguments[5]:void 0;(0,_jquery.default)("body").on("click","#analytic"+userid+questionid,(function(e){(0,_jquery.default)("#rep"+userid+questionid).prop("disabled",!1),e.preventDefault(),(0,_jquery.default)("#content"+userid).html((0,_jquery.default)("<div>").addClass("d-flex justify-content-center my-5").append((0,_jquery.default)("<div>").addClass("tiny-cursive-loader"))),replayInstances&&replayInstances[userid]&&replayInstances[userid].stopReplay(),(0,_jquery.default)(".active").removeClass("active"),(0,_jquery.default)(this).addClass("active"),templates.render("tiny_cursive/analytics_table",context).then((function(html){(0,_jquery.default)("#content"+userid).html(html),(0,_jquery.default)("#content"+userid+" .table tbody tr:first-child td:nth-child(2)").html(authIcon)})).fail((function(error){console.error("Failed to render template:",error)}))}))}checkDiff(userid,fileid){let questionid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",replayInstances=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const nodata=document.createElement("p");nodata.classList.add("text-center","p-5","bg-light","rounded","m-5","text-primary"),nodata.style.verticalAlign="middle",nodata.style.textTransform="uppercase",nodata.style.fontWeight="500",nodata.textContent="no data received yet",(0,_jquery.default)("body").on("click","#diff"+userid+questionid,(function(e){if((0,_jquery.default)("#rep"+userid+questionid).prop("disabled",!1),e.preventDefault(),(0,_jquery.default)("#content"+userid).html((0,_jquery.default)("<div>").addClass("d-flex justify-content-center my-5").append((0,_jquery.default)("<div>").addClass("tiny-cursive-loader"))),(0,_jquery.default)(".active").removeClass("active"),replayInstances&&replayInstances[userid]&&replayInstances[userid].stopReplay(),(0,_jquery.default)(this).addClass("active"),!fileid)throw(0,_jquery.default)("#content"+userid).html(nodata),new Error("Missing file id or Difference Content not receive yet");(0,_ajax.call)([{methodname:"cursive_get_writing_differences",args:{fileid:fileid}}])[0].done((response=>{let responsedata=JSON.parse(response.data);if(responsedata[0]){let submitted_text=atob(responsedata[0].submitted_text);responsedata[0].reconstructed_text;const $legend=(0,_jquery.default)('<div class= "d-flex p-2 border rounded  mb-2">');let unattibuted="Edits, Pastes, AI",attibuted="Original Text";const $attributedItem=(0,_jquery.default)("<div>",{class:"cursive-legend-item"}),$attributedBox=(0,_jquery.default)("<div>",{class:"cursive-box attributed"}),$attributedText=(0,_jquery.default)("<span>").text(attibuted);$attributedItem.append($attributedBox).append($attributedText);const $unattributedItem=(0,_jquery.default)("<div>",{class:"cursive-legend-item"}),$unattributedBox=(0,_jquery.default)("<div>",{class:"cursive-box tiny_cursive_added"}),$unattributedText=(0,_jquery.default)("<span>").text(unattibuted);$unattributedItem.append($unattributedBox).append($unattributedText),$legend.append($attributedItem).append($unattributedItem);let contents=(0,_jquery.default)("<div>").addClass("cursive-comparison-content"),textBlock2=(0,_jquery.default)("<div>").addClass("cursive-text-block").append((0,_jquery.default)("<div>").attr("id","cursive-reconstructed_text").html(JSON.parse(submitted_text)));contents.append($legend,textBlock2),(0,_jquery.default)("#content"+userid).html(contents)}else(0,_jquery.default)("#content"+userid).html(nodata)})).fail((error=>{throw(0,_jquery.default)("#content"+userid).html(nodata),new Error("Error loading JSON file: "+error.message)}))}))}replyWriting(userid,filepath){let questionid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",replayInstances=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,_jquery.default)("body").on("click","#rep"+userid+questionid,(function(e){(0,_jquery.default)(this).prop("disabled",!0),e.preventDefault(),(0,_jquery.default)("#content"+userid).html((0,_jquery.default)("<div>").addClass("d-flex justify-content-center my-5").append((0,_jquery.default)("<div>").addClass("tiny-cursive-loader"))),(0,_jquery.default)(".active").removeClass("active"),(0,_jquery.default)(this).addClass("active"),replayInstances&&replayInstances[userid]&&replayInstances[userid].stopReplay(),video_playback(userid,filepath)}))}formatedTime(data){if(data.total_time_seconds){let total_time_seconds=data.total_time_seconds,hours=Math.floor(total_time_seconds/3600).toString().padStart(2,0),minutes=Math.floor(total_time_seconds%3600/60).toString().padStart(2,0),seconds=(total_time_seconds%60).toString().padStart(2,0);return"".concat(hours,"h ").concat(minutes,"m ").concat(seconds,"s")}return"0h 0m 0s"}authorshipStatus(firstFile,score,score_setting){score=parseFloat(score);var icon="fa fa-circle-o",color="font-size:32px;color:black";return firstFile?(icon="fa  fa fa-solid fa-info-circle",color="font-size:32px;color:#000000"):score>=score_setting?(icon="fa fa-check-circle",color="font-size:32px;color:green"):score<score_setting?(icon="fa fa-question-circle",color="font-size:32px;color:#A9A9A9"):(icon="fa fa-circle-o",color="font-size:32px;color:black"),(0,_jquery.default)("<i>").addClass(icon).attr("style",color)}},_exports.default}));

//# sourceMappingURL=analytic_events.min.js.map