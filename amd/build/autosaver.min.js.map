{"version":3,"file":"autosaver.min.js","sources":["../src/autosaver.js"],"sourcesContent":["/**\n * @module     tiny_cursive/autosaver\n * @category TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author kuldeep singh <mca.kuldeep.sekhon@gmail.com>\n */\n\nimport { call } from 'core/ajax';\nimport { create } from 'core/modal_factory';\nimport {get_string as getString} from 'core/str';\n//import {render} from 'core/templates';\nimport {save,cancel,hidden} from 'core/modal_events';\nimport jQuery from 'jquery';\nexport const register = (editor) => {\n    const postOne = (methodname, args) => call([{\n        methodname,\n        args,\n    }])[0];\n    var is_student=!(jQuery('#body').hasClass('teacher_admin'));\n    var intervention=jQuery('#body').hasClass('intervention');\n    const showLog=()=>{\n        window.console.log(editor);\n    };\n    const getModal = (e) => {\n        return create({\n            type:'SAVE_CANCEL',\n            title: getString('tiny_cursive','tiny_cursive'),\n            body: '<textarea  class=\"form-control inputUrl\" value=\"\" id=\"inputUrl\" placeholder=\"sourceurl\"></textarea>',\n            // render(\"tiny_cursive/popup_form\", \"\"),\n            removeOnClose: true,\n        },showLog())\n        .done(modal => {\n            modal.getRoot().append('<style>.close{ display: none ! important; }</style>');\n              modal.show();\n              var lastEvent='';\n              modal.getRoot().on(save, function() {\n                var number=document.getElementById(\"inputUrl\").value;\n                if (number === \"\" || number === null || number === undefined) {\n                    editor.execCommand('Undo');\n                    alert(\"You cannot paste text without providing source\");\n                } else {\n                 editor.execCommand('Paste');\n                }\n                let ur = e.srcElement.baseURI;\n                let parm = new URL(ur);\n                let recourceId=0;\n                let cmid=0;\n                let modulename=\"\";\n                let editorid=editor?.id;\n                if (ur.includes(\"attempt.php\")||ur.includes(\"forum\")||ur.includes(\"assign\")){ }else{\n                    return false;\n                }\n                if (ur.includes(\"forum\")||ur.includes(\"assign\")) {\n                    cmid=parm.searchParams.get('id');\n                }else{\n                    cmid=parm.searchParams.get('cmid');\n                    recourceId=parm.searchParams.get('attempt');\n                }\n                if(recourceId===null){\n                    recourceId=0;\n                }\n                if (ur.includes(\"forum\")){\n                    modulename=\"forum\";\n                }\n                if (ur.includes(\"assign\")){\n                    modulename=\"assign\";\n                }\n                if (ur.includes(\"attempt\")){\n                    modulename=\"quiz\";\n                }\n                if(cmid===null){ cmid=0;}\n\n                postOne('cursive_user_comments', {\n                    modulename: modulename,\n                    cmid: cmid,\n                    resourceid: recourceId,\n                    courseid: 0,\n                    usercomment:number,\n                    timemodified:\"1121232\",\n                    editorid:editorid?editorid:\"\"\n                });\n                lastEvent='save';\n                modal.destroy();\n              });\n                modal.getRoot().on(cancel, function() {\n                        editor.execCommand('Undo');\n                        lastEvent='cancel';\n                    });\n                modal.getRoot().on(hidden, function() {\n                        if(lastEvent!='cancel'&& lastEvent!='save'){editor.execCommand('Undo');}\n                    });\n            return modal;\n        });\n    };\n    const sendKeyEvent=(event, ed)=>{\n         let ur = ed.srcElement.baseURI;\n         let parm = new URL(ur);\n         let recourceId=0;\n         let modulename=\"\";\n        let cmid=0;\n        let editorid=editor?.id;\n         if (ur.includes(\"attempt.php\")||ur.includes(\"forum\")||ur.includes(\"assign\")){}else{\n            return false;\n         }\n         if (ur.includes(\"forum\")||ur.includes(\"assign\")) {\n            cmid=parm.searchParams.get('id');\n        }else{\n            cmid=parm.searchParams.get('cmid');\n            recourceId=parm.searchParams.get('attempt');\n        }\n        // if(recourceId===null){\n        //     recourceId=0;\n        // }\n        if(cmid===null){ cmid=0;}\n        if (ur.includes(\"forum\")){\n            if(reply=parm.searchParams.get('reply')){\n                cmid=reply; // Find cmid using reply id.\n            }else if(parm.searchParams.get('edit')){\n                recourceId=parm.searchParams.get('edit'); // Find cmid using resouceid id.\n                console.log(\"here: \", recourceId);           \n            };\n            \n            modulename=\"forum\";\n        }\n        if (ur.includes(\"assign\")){\n            modulename=\"assign\";\n        }\n        if (ur.includes(\"attempt\")){\n            modulename=\"quiz\";\n        }\n        postOne('cursive_json', {\n            key: ed.key,\n            event: event,\n            keyCode: ed.keyCode,\n            resourceId: recourceId,\n            cmid:cmid,\n            modulename:modulename,\n            editorid:editorid?editorid:\"\"\n        });\n    };\n    editor.on('keyUp', (editor) => {\n        sendKeyEvent(\"keyUp\", editor);\n    });\n    editor.on('Paste', async (e) => {\n        if(is_student && intervention){\n            getModal(e);\n        }\n    });\n    editor.on('Redo', async (e) => {\n        if(is_student  && intervention){\n            getModal(e);\n        }\n    });\n    editor.on('keyDown', (editor) => {\n        sendKeyEvent(\"keyDown\", editor);\n    });\n    editor.on('init', () => {\n    });\n};\n"],"names":["editor","postOne","methodname","args","is_student","hasClass","intervention","getModal","e","type","title","body","removeOnClose","window","console","log","done","modal","getRoot","append","show","lastEvent","on","save","number","document","getElementById","value","execCommand","alert","ur","srcElement","baseURI","parm","URL","recourceId","cmid","modulename","editorid","id","includes","searchParams","get","resourceid","courseid","usercomment","timemodified","destroy","cancel","hidden","sendKeyEvent","event","ed","reply","key","keyCode","resourceId","async"],"mappings":"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"}